
**Introduction**

`Impumetric` is a tool to examine the imputation result.

* Rsq: The standard Minimac metric.

* EmpRsq: The squared correlation between WGS and imputed datasets. Also known as the dosage $r^2$.

* MARE: MAF-adjusted-residual-error, to quantify the deviation between Rsq and EmpRsq, which indicates some systematic bias in the imputation pipeline.

* $\beta_{imp}$: The regression slope between imputed dosage and true genotype, which indicates the imputed dosages are shrunk to the alternative allele frequency or not.

**Usage**

1. Using it as a script

* Vcf file from Minimac4 `--meta` option could be directly parsed.

```sh
python impumetric.py --loovcf ../data/chr19.empiricalDose.vcf.gz

head chr19.empiricalDose.vcf.gz.scores.txt
```

The loovcf file contains the true allele and imputed haploid dosage. Rsq, EmpRsq, MARE, and Beta_imp will be calculated on the haploid data.

```
        Rsq     EmpR    MARE    Beta_imp        EmpRsq
chr19:247265:G:T        0.862   0.878   0.197   0.712   0.772
```

* For other vcf files, it requires [`bcftools`](https://samtools.github.io/bcftools/) to extract the genotypes/dosages first.

For example,

```sh
bcftools query -f'%ID[\t%HDS]\n' $inpath > $outpath
```

Providing both WGS and imputed dataset (should have the same variants and samples)

```sh
python impumetric.py --imputed ../data/chr19.HDS.sample.txt --wgs ../data/chr19.GT.sample.txt

head chr19.HDS.sample.txt.scores.txt   
```

WGS dataset is usually not phased, thus, the values will be calculated on the diploid data. Rsq will be on haploid data when `HDS` is available.

```   
0       Rsq     EmpR    MARE    Beta_imp        EmpRsq
chr19:247265:G:T        0.862   0.872   0.197   0.709   0.76
```

* Providing the imputed dataset only

```sh
python impumetric.py --imputed ../data/chr19.HDS.sample.txt

head chr19.HDS.sample.txt.scores.Rsq.txt
```

If only a imputed dataset is provided, only Rsq could be calculated.

```
0       Rsq
chr19:247265:G:T        0.862
```

2. Using it via `import`

Plotting functions are not parsered. These functions need import.

```py
from scores import *
from plot import *

fig = plot_Beta(newdf, "beta", "EmpRsq", filename=None)
```

3. Using it as a python package

It could also be imported as a package and integrated into a pipeline.

```py
import sys
sys.path.append(r"path to impumetric package/src")
import impumetric as imp

imp.plot_scatter("EAS.chr19.info.gz", xcol="EmpRsq", ycol="LooRsq", xname=None, yname=None, 
                 filename="EAS.scatter", contour=True)
```

The `ipynb` and `html` files give some examples, e.g., matching the variant ID between two datasets, calculating metric values, and plotting. The `data/TOPMed-imputed 1KG` folder provides the sample dataset. It is generated by submitting the 1KG (array) to the TOPMed imputation server, with `--meta` option on.

Citation:

[*#1* TBD](TBD)
